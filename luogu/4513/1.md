---
_id: "luogu-P4513"
title: "小白逛公园"
date: 2020-01-10 16:22
update: 2020-01-10 16:22
author: Rainboy
tags:
    - 线段树
catalog: 线段树
source: 
    - 
      oj: luogu
      url: https://www.luogu.com.cn/problem/P4513
---

@[toc]

## 题目

### 题目背景 
小新经常陪小白去公园玩，也就是所谓的遛狗啦…



### 题目描述

在小新家附近有一条“公园路”，路的一边从南到北依次排着$n$个公园，小白早就看花了眼，自己也不清楚该去哪些公园玩了。  

一开始，小白就根据公园的风景给每个公园打了分-.-。小新为了省事，每次遛狗的时候都会事先规定一个范围，小白只可以选择第$a$个和第$b$个公园之间（包括$a$、$b$两个公园）选择连续的一些公园玩。小白当然希望选出的公园的分数总和尽量高咯。同时，由于一些公园的景观会有所改变，所以，小白的打分也可能会有一些变化。  

那么，就请你来帮小白选择公园吧。



### 输入格式
 第一行，两个整数$N$和$M$，分别表示表示公园的数量和操作（遛狗或者改变打分）总数。  
    接下来$N$行，每行一个整数，依次给出小白 开始时对公园的打分。  
    接下来$M$行，每行三个整数。第一个整数$K$，$1$或$2$。
- $K=1$表示，小新要带小白出去玩，接下来的两个整数$a$和$b$给出了选择公园的范围（$1≤a,b≤N$）。测试数据可能会出现$a>b$的情况，需要进行交换；
- $K=2$表示，小白改变了对某个公园的打分，接下来的两个整数$p$和$s$，表示小白对第$p$个公园的打分变成了$s$（$1≤p≤N$）。  
    其中，$1≤N≤500 000$，$1≤M≤100 000$，所有打分都是绝对值不超过$1000$的整数。  



### 输出格式

 小白每出去玩一次，都对应输出一行，只包含一个整数，表示小白可以选出的公园得分和的最大值。



### 样例

|----|----|
|输入 #1  |输出 #1  |
|```  |```  \
|5 3  |2  \
|1 2 -3 4 5  |-1  \
|1 2 3  |```  \
|2 2 -1  |   \
|1 2 3  |   \
|```  |   |


## 解析

**带单点修改的某区间最大连续子段和**

**核心的思路就是在于如何合并两个区间**

两个区间合并:产生的新的最值的可能:

 - 原本的两个的最值的中的最大值
 - 区间1的从右开始的最值 与 区间2从左开始的最值的合并


```
4 -5 3 1 2 3
```

[1,3]的最值4. [1,3]与[4,6]的合并

经过什么么样子的思考历程,得到这种想法呢?

1.区间分为[left,max,right]三个部分

发现不能合并(对拍错误)

2.
因为需要3这个从左开始的区间最值

区间分为.[left_max,right_max]

思考:应更在加入区间和(对应题目所有打分都是绝对值不超过1000的整数)

可以合并,发现想不出来,如何查询,或者查询的时间是O(n)


3.不能查询是因为缺少信息:最大值,

![Untitled Diagram.png](https://i.loli.net/2020/01/26/gvAZiayVmQhtDsI.png)

把最大值的信息直接放进去,(像1一样),思考,可以合并,可以查询



## 代码

```c
<%- include("1.cpp") %>
```

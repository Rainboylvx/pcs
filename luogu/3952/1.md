---
_id: "luogu-P3952"
title: "[NOIP2017 提高组] 时间复杂度"
date: 2023-07-31 09:20
update: 2023-07-31 09:20
author: Rainboy
tags:
    - 模拟
    - 毒瘤
source: 
    - 
      oj: luogu-P3952
      url: https://www.luogu.com.cn/problem/P3952
---

@[toc]

## 题目

### 题目背景 
NOIP2017 提高组 D1T2



### 题目描述

小明正在学习一种新的编程语言 A++，刚学会循环语句的他激动地写了好多程序并 给出了他自己算出的时间复杂度，可他的编程老师实在不想一个一个检查小明的程序， 于是你的机会来啦！下面请你编写程序来判断小明对他的每个程序给出的时间复杂度是否正确。

A++语言的循环结构如下：

 
```cpp
F i x y
    循环体
E
```
 
 
其中`F i x y`表示新建变量 $i$（变量 $i$ 不可与未被销毁的变量重名）并初始化为 $x$， 然后判断 $i$ 和 $y$ 的大小关系，若 $i$ 小于等于 $y$ 则进入循环，否则不进入。每次循环结束后 $i$ 都会被修改成 $i +1$，一旦 $i$ 大于 $y$ 终止循环。

$x$ 和 $y$ 可以是正整数（$x$ 和 $y$ 的大小关系不定）或变量 $n$。$n$ 是一个表示数据规模的变量，在时间复杂度计算中需保留该变量而不能将其视为常数，该数远大于 $100$。

`E` 表示循环体结束。循环体结束时，这个循环体新建的变量也被销毁。

注：本题中为了书写方便，在描述复杂度时，使用大写英文字母 $\operatorname O$ 表示通常意义下 $Θ$ 的概念。




### 输入格式
输入文件第一行一个正整数 $t$，表示有 $t$（$t \le 10$）个程序需要计算时间复杂度。 每个程序我们只需抽取其中 `F i x y` 和 `E` 即可计算时间复杂度。注意：循环结构允许嵌套。

接下来每个程序的第一行包含一个正整数 $L$ 和一个字符串，$L$ 代表程序行数，字符串表示这个程序的复杂度，`O(1)` 表示常数复杂度，`O(n^w)` 表示复杂度为 $n^w$，其中 $w$ 是一个小于 $100$ 的正整数，输入保证复杂度只有 `O(1)` 和 `O(n^w)` 两种类型。

接下来 $L$ 行代表程序中循环结构中的`F i x y`或者 `E`。 程序行若以`F`开头，表示进入一个循环，之后有空格分离的三个字符（串）`i x y`， 其中 $i$ 是一个小写字母（保证不为$n$），表示新建的变量名，$x$ 和 $y$ 可能是正整数或 $n$ ，已知若为正整数则一定小于 $100$。

程序行若以`E`开头，则表示循环体结束。




### 输出格式

输出文件共 $t$ 行，对应输入的 $t$ 个程序，每行输出 `Yes` 或 `No` 或者 `ERR`，若程序实际复杂度与输入给出的复杂度一致则输出 `Yes`，不一致则输出 `No`，若程序有语法错误（其中语法错误只有: ① `F` 和 `E` 不匹配 ②新建的变量与已经存在但未被销毁的变量重复两种情况），则输出 `ERR`。

注意：即使在程序不会执行的循环体中出现了语法错误也会编译错误，要输出 `ERR`。




### 样例



输入/输出 # 1

::: line
```
8
2 O(1)
F i 1 1
E
2 O(n^1)
F x 1 n
E
1 O(1)
F x 1 n
4 O(n^2)
F x 5 n
F y 10 n
E
E
4 O(n^2)
F x 9 n
E
F y 2 n
E
4 O(n^1)
F x 9 n
F y n 4
E
E
4 O(1)
F y n 4
F x 9 n
E
E
4 O(n^2)
F x 1 n
F x 1 10
E
E
```

```
Yes
Yes
ERR
Yes
No
Yes
Yes
ERR
```
:::





### 说明/提示
【输入输出样例解释 $1$】

第一个程序 $i$ 从 $1$ 到 $1$ 是常数复杂度。

第二个程序 $x$ 从 $1$ 到 $n$ 是 $n$ 的一次方的复杂度。

第三个程序有一个 `F` 开启循环却没有 `E` 结束，语法错误。

第四个程序二重循环，$n$ 的平方的复杂度。

第五个程序两个一重循环，$n$ 的一次方的复杂度。

第六个程序第一重循环正常，但第二重循环开始即终止（因为 $n$ 远大于 $100$，$100$ 大于 $4$）。

第七个程序第一重循环无法进入，故为常数复杂度。

第八个程序第二重循环中的变量 $x$ 与第一重循环中的变量重复，出现语法错误②，输出 `ERR`。

【数据规模与约定】

对于 $30\%$ 的数据：不存在语法错误，数据保证小明给出的每个程序的前 $L/2$ 行一定为以 `F` 开头的语句，第 $L/2+1$ 行至第 $L$ 行一定为以 `E` 开头的语句，$L  \le 10$，若 $x$、$y$ 均为整数，$x$ 一定小于 $y$，且只有 $y$ 有可能为 $n$。

对于 $50\%$ 的数据：不存在语法错误，$L  \le 100$，且若 $x$、$y$ 均为整数，$x$ 一定小于 $y$， 且只有 $y$ 有可能为 $n$。

对于 $70\%$ 的数据：不存在语法错误，$L  \le 100$。

对于 $100\%$ 的数据：$L  \le 100$。


---
如果需要Hack请私信@zhouyonglong或发讨论，提供数据和能Hack掉的本题的AC记录。


## 解析

这个题目的本质就是一个 写一个非常弱智的代码编译器(解析器)

按一般的写编译器的流程

```
字节流 -> token -> 语法树 -> 表达式树 --> 解析(作用域block)
```

我的想法:

首先是复杂度

- `O(1)`,表明没有出现过n,循环的数也是一个常数
- `O(n^w)`,w是一个整数,这个表示有w层嵌套的带有`常数->n`的这种循环


需要考虑的情况

会出现无法进入的循环`F x n 4`,则需要在循环内部的其它语句都略过
所谓的略过就是这中间的语句,都不计算时间.
当然这需要计算语法错误

可以想像出来,我们停的把东西加入的到栈上,每一次的时间,都要根据上一次(栈顶)
来计算时间,这就像一个dp一样,这里我们需要设计


```
f = 'e' 出现错误
f = '1' 时间为o(1)
f = 'n2' 时间为n^2

当然还考虑,前面是无法进入的循环
```

显然这是一个状态机

```
struct f_state{
    bool calc; // 是否需要计算时间
    bool err; //  是否出现语法错误
    bool o1; //是否是常数时间
    int w;  // 不是常数时间时,n^w的值是多少
}
```

同时我们需要根据上一个状态,和当前数据,计算下一个状态


如何判断变量的重复定义呢?

使用桶🪣,在栈上就记为1,否则为0,如果已经为1就错了

- 读取F或E就算一行

记录一下我写的时间手滑导致的错误

1. `65`行,最初没有加,给news初始化,导致全错
2. `83`行,`if( nx > ny) {`,手滑,写`if( x > y)` 导致错一个点

## 代码

```c
<%- include("1.cpp") %>
```
